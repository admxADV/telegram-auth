# PAVEPO - Авторизация через Telegram

Веб-приложение для авторизации пользователей через Telegram бота с админ-панелью.

## Структура проекта

```
telegram-auth/
├── src/
│   ├── index.html       # Главная страница авторизации
│   ├── dashboard.html   # Личный кабинет пользователя
│   ├── admin.html       # Админ-панель
│   ├── styles.css       # Стили
│   ├── script.js        # Логика авторизации
│   ├── dashboard.js     # Личный кабинет
│   ├── admin.js         # Админ-панель
│   └── assets/          # Изображения
├── server.js            # Сервер + Telegram бот
├── bot.js               # (устарел, теперь в server.js)
├── package.json
├── render.yaml          # Конфигурация для Render.com
├── .env.example         # Шаблон переменных окружения
└── README.md
```

## Локальный запуск

### Требования

- Node.js 18+
- PostgreSQL (для локальной разработки)

### Установка

```bash
cd telegram-auth
npm install
```

### Запуск

```bash
# Создайте файл .env
cp .env.example .env

# Отредактируйте .env и укажите DATABASE_URL и TELEGRAM_BOT_TOKEN

# Запустите сервер
npm start
```

Откройте в браузере: http://localhost:3000

## Деплой на Render.com

### Шаг 1: Подготовка

1. Создайте репозиторий на GitHub и запушьте проект:
   ```bash
   git init
   git add .
   git commit -m "Initial commit"
   git remote add origin https://github.com/yourusername/telegram-auth.git
   git push -u origin main
   ```

### Шаг 2: Создание сервиса на Render

1. Зарегистрируйтесь на [render.com](https://render.com)
2. Нажмите **New +** → **Blueprint**
3. Подключите ваш GitHub репозиторий
4. Render автоматически распознает `render.yaml` и создаст:
   - Web Service для приложения
   - PostgreSQL базу данных

### Шаг 3: Настройка переменных окружения

В панели Render перейдите в ваш сервис и добавьте переменные:

| Ключ | Значение |
|------|----------|
| `TELEGRAM_BOT_TOKEN` | Токен бота от @BotFather |
| `ADMIN_USER_ID` | 5093303797 |
| `NODE_ENV` | production |

**Примечание:** `DATABASE_URL` автоматически добавляется Render при создании базы данных.

### Шаг 4: Деплой

1. Перейдите во вкладку **Logs** и дождитесь завершения сборки
2. После успешного деплоя скопируйте URL сервиса (вида `https://pavepo-auth.onrender.com`)

### Шаг 5: Настройка бота

Обновите URL бота в коде (если нужно) или используйте текущий.

## Функционал

### Авторизация
1. Пользователь нажимает "Войти через Telegram"
2. Генерируется уникальный токен сессии
3. Открывается бот @pavepobot с командой /start TOKEN
4. Бот подтверждает личность пользователя
5. Пользователь автоматически перенаправляется в личный кабинет

### Личный кабинет
- Заполнение профиля (компания, отдел, должность)
- Сохранение данных в PostgreSQL
- Просмотр статуса заполнения профиля

### Админ-панель (доступна только @bypopov)
- Просмотр всех зарегистрированных пользователей
- Информация о каждом пользователе
- Поиск и сортировка

## Настройки бота

- **Имя бота:** @pavepobot
- **ID администратора:** 5093303797 (@bypopov)

## База данных

PostgreSQL хранит:
- `users` - пользователи (telegram_id, username, first_name, last_name)
- `profiles` - профили пользователей (company, department, job_title)
- `business_processes` - бизнес-процессы пользователей
- `quiz_questions` - вопросы тестов
- `quiz_answers` - ответы пользователей

## Технологии

- Node.js
- pg (PostgreSQL клиент)
- node-telegram-bot-api
- Нативный HTTP сервер

## Важные замечания

### Бесплатный тариф Render

- **Web Service:** 750 часов/месяц бесплатно (достаточно для одного сервиса)
- **PostgreSQL:** 90 дней бесплатно, затем нужно создать новую или перейти на платный
- **Сон сервиса:** На бесплатном тарифе сервис "засыпает" после 15 минут бездействия. Первый запрос после простоя будет обрабатываться ~30-50 секунд.

### Рекомендации

1. Для продакшена рассмотрите платный тариф Render ($7/мес)
2. Альтернативы: Railway.app, Fly.io
3. Регулярно делайте бэкапы базы данных

## Лицензия

MIT
