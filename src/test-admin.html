<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>–¢–µ—Å—Ç –∞–¥–º–∏–Ω–∫–∏</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #667eea; color: white; }
        .card { background: white; color: black; padding: 20px; border-radius: 10px; max-width: 600px; margin: 0 auto; }
        button { padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        pre { background: #f0f0f0; padding: 10px; border-radius: 5px; overflow: auto; }
    </style>
</head>
<body>
    <div class="card">
        <h1>üîß –¢–µ—Å—Ç –∞–¥–º–∏–Ω–∫–∏</h1>
        <div id="status">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <h2>–î–µ–π—Å—Ç–≤–∏—è:</h2>
        <button onclick="checkSession()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Å—Å–∏—é</button>
        <button onclick="loadUsers()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</button>
        <button onclick="viewTestAnswers()">–¢–µ—Å—Ç–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã</button>
        <button onclick="logout()">–í—ã–π—Ç–∏</button>
        <h2>–õ–æ–≥:</h2>
        <pre id="log"></pre>
    </div>

    <script>
    const ADMIN_USER_ID = 5093303797;
    
    function log(msg) {
        document.getElementById('log').textContent += msg + '\n';
        console.log(msg);
    }

    function checkSession() {
        const token = sessionStorage.getItem('auth_session');
        log('–¢–æ–∫–µ–Ω: ' + (token ? token.substring(0, 30) + '...' : '–ù–ï–¢'));
        
        fetch('/api/auth/check/' + token)
            .then(r => r.json())
            .then(d => {
                log('–°–µ—Å—Å–∏—è: ' + JSON.stringify(d, null, 2));
                if (d.authorized && d.user_id == ADMIN_USER_ID) {
                    log('‚úÖ –í–´ –ê–î–ú–ò–ù!');
                } else if (d.authorized) {
                    log('‚ö†Ô∏è –í—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã, –Ω–æ –ù–ï –∞–¥–º–∏–Ω (user_id=' + d.user_id + ')');
                } else {
                    log('‚ùå –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã');
                }
            })
            .catch(e => log('–û—à–∏–±–∫–∞: ' + e.message));
    }

    function loadUsers() {
        const token = sessionStorage.getItem('auth_session');
        log('–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...');
        
        fetch('/api/admin/users', {
            headers: { 'Authorization': 'Bearer ' + token }
        })
        .then(r => {
            log('–°—Ç–∞—Ç—É—Å: ' + r.status);
            return r.json();
        })
        .then(d => {
            log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏: ' + JSON.stringify(d, null, 2));
        })
        .catch(e => log('–û—à–∏–±–∫–∞: ' + e.message));
    }

    function viewTestAnswers() {
        const token = sessionStorage.getItem('auth_session');
        log('–ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ —Ç–µ—Å—Ç–∞...');
        
        fetch('/api/admin/quiz-answers/7273603260', {
            headers: { 'Authorization': 'Bearer ' + token }
        })
        .then(r => {
            log('–°—Ç–∞—Ç—É—Å: ' + r.status);
            return r.json();
        })
        .then(d => {
            log('–û—Ç–≤–µ—Ç—ã: ' + JSON.stringify(d, null, 2));
        })
        .catch(e => log('–û—à–∏–±–∫–∞: ' + e.message));
    }

    function logout() {
        sessionStorage.removeItem('auth_session');
        log('–°–µ—Å—Å–∏—è –æ—á–∏—â–µ–Ω–∞. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
    }

    // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫
    window.onload = function() {
        log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
        log('ADMIN_USER_ID = ' + ADMIN_USER_ID);
        checkSession();
    };
    </script>
</body>
</html>
