<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</title>
    <style>
        body {
            font-family: monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
        }
        .log { margin: 10px 0; }
        .error { color: #ff4444; }
        .success { color: #00ff00; }
        .warn { color: #ffbb00; }
        button {
            padding: 10px 20px;
            margin: 10px 5px 10px 0;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        button:hover { background: #5568d3; }
        pre {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h1>
    
    <div>
        <button onclick="checkSession()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Å—Å–∏—é</button>
        <button onclick="clearSession()">–û—á–∏—Å—Ç–∏—Ç—å —Å–µ—Å—Å–∏—é</button>
        <button onclick="goToAdmin()">–ü–µ—Ä–µ–π—Ç–∏ –≤ –∞–¥–º–∏–Ω–∫—É</button>
        <button onclick="goToDashboard()">–í –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</button>
    </div>

    <div id="output"></div>

    <script>
    const ADMIN_USER_ID = 5093303797;
    
    function log(message, type = 'log') {
        const div = document.createElement('div');
        div.className = `log ${type}`;
        div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        document.getElementById('output').appendChild(div);
    }

    function checkSession() {
        document.getElementById('output').innerHTML = '';
        
        const authToken = sessionStorage.getItem('auth_session');
        const userId = sessionStorage.getItem('user_id');
        
        log('sessionStorage.auth_session: ' + (authToken ? authToken.substring(0, 30) + '...' : 'null'), authToken ? 'success' : 'error');
        log('sessionStorage.user_id: ' + userId, userId ? 'success' : 'error');
        
        if (!authToken) {
            log('‚ùå –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω! –ù—É–∂–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ.', 'error');
            return;
        }

        log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ...', 'warn');
        
        fetch('/api/auth/check/' + authToken)
            .then(r => {
                log('Status: ' + r.status, r.ok ? 'success' : 'error');
                return r.json();
            })
            .then(data => {
                log('–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞: ' + JSON.stringify(data, null, 2), 'success');
                
                if (data.authorized) {
                    log('‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!', 'success');
                    
                    const uid = parseInt(data.user_id) || parseInt(data.telegram_id);
                    log('–í–∞—à user_id: ' + uid, 'success');
                    log('ADMIN_USER_ID: ' + ADMIN_USER_ID, 'warn');
                    
                    if (uid === ADMIN_USER_ID) {
                        log('üéâ –í—ã –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†!', 'success');
                        log('‚û°Ô∏è –ú–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–π—Ç–∏ –≤ –∞–¥–º–∏–Ω–∫—É', 'success');
                    } else {
                        log('‚ö†Ô∏è –í—ã –Ω–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', 'warn');
                    }
                } else {
                    log('‚ùå –¢–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–µ–Ω', 'error');
                }
            })
            .catch(err => {
                log('–û—à–∏–±–∫–∞: ' + err.message, 'error');
            });
    }

    function clearSession() {
        sessionStorage.removeItem('auth_session');
        sessionStorage.removeItem('user_id');
        log('üóëÔ∏è –°–µ—Å—Å–∏—è –æ—á–∏—â–µ–Ω–∞', 'warn');
    }

    function goToAdmin() {
        window.location.href = '/admin-new.html';
    }

    function goToDashboard() {
        window.location.href = '/dashboard.html';
    }

    // –ê–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    window.onload = () => {
        log('üìÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'log');
        checkSession();
    };
    </script>
</body>
</html>
